[
  {
    "name": "celery-worker-container",
    "image": "${REPOSITORY}/harvester:${version}",
    "cpu": 0,
    "essential": true,
    "command": ["celery", "-A", "harvester", "worker", "--concurrency=${concurrency}", "--loglevel=info", "-n=main-worker@%h"],
    "environment": [
      { "name" : "PYTHONUNBUFFERED", "value" : "1" },
      { "name" : "APPLICATION_MODE", "value" : "${mode}" }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "/ecs/harvester",
        "awslogs-region": "eu-central-1",
        "awslogs-stream-prefix": "${version}",
        "awslogs-multiline-pattern": "^\\[?\\d\\d\\d\\d\\-\\d\\d\\-\\d\\d \\d\\d:\\d\\d:\\d\\d,\\d\\d\\d"
      }
    }
  },
  {
    "name": "analyzer",
    "image": "${REPOSITORY}/analyzer:latest",
    "essential": true,
    "portMappings": [
      {
        "hostPort": 9090,
        "protocol": "tcp",
        "containerPort": 9090
      }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "/ecs/harvester",
        "awslogs-region": "eu-central-1",
        "awslogs-stream-prefix": "analyzer",
        "awslogs-multiline-pattern": "^\\[?\\d\\d\\d\\d\\-\\d\\d\\-\\d\\d \\d\\d:\\d\\d:\\d\\d,\\d\\d\\d"
      }
    }
  }
]
